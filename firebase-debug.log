[debug] [2025-05-19T14:15:00.668Z] ----------------------------------------------------------------------
[debug] [2025-05-19T14:15:00.671Z] Command:       /opt/homebrew/Cellar/node/23.10.0_1/bin/node /opt/homebrew/bin/firebase serve
[debug] [2025-05-19T14:15:00.671Z] CLI Version:   14.2.1
[debug] [2025-05-19T14:15:00.671Z] Platform:      darwin
[debug] [2025-05-19T14:15:00.671Z] Node Version:  v23.10.0
[debug] [2025-05-19T14:15:00.671Z] Time:          Mon May 19 2025 23:15:00 GMT+0900 (日本標準時)
[debug] [2025-05-19T14:15:00.672Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-05-19T14:15:00.926Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-05-19T14:15:00.926Z] > authorizing via signed-in user (k.yamaoka0919@gmail.com)
[debug] [2025-05-19T14:15:00.926Z] [iam] checking project nyanco-bot for permissions ["firebase.projects.get"]
[debug] [2025-05-19T14:15:00.927Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:00.927Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:00.927Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/nyanco-bot:testIamPermissions [none]
[debug] [2025-05-19T14:15:00.928Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/nyanco-bot:testIamPermissions x-goog-quota-user=projects/nyanco-bot
[debug] [2025-05-19T14:15:00.928Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/nyanco-bot:testIamPermissions {"permissions":["firebase.projects.get"]}
[debug] [2025-05-19T14:15:01.625Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/nyanco-bot:testIamPermissions 200
[debug] [2025-05-19T14:15:01.625Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/nyanco-bot:testIamPermissions {"permissions":["firebase.projects.get"]}
[debug] [2025-05-19T14:15:01.626Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:01.626Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:01.626Z] >>> [apiv2][query] GET https://cloudresourcemanager.googleapis.com/v1/projects/nyanco-bot [none]
[debug] [2025-05-19T14:15:01.807Z] <<< [apiv2][status] GET https://cloudresourcemanager.googleapis.com/v1/projects/nyanco-bot 200
[debug] [2025-05-19T14:15:01.807Z] <<< [apiv2][body] GET https://cloudresourcemanager.googleapis.com/v1/projects/nyanco-bot {"projectNumber":"242432500390","projectId":"nyanco-bot","lifecycleState":"ACTIVE","name":"nyanco-bot","labels":{"firebase":"enabled","firebase-core":"disabled"},"createTime":"2025-05-19T14:03:31.642907Z"}
[info] 
[info] === Serving from '/Users/kozzy/src/commupro-guild'...
[info] 
[debug] [2025-05-19T14:15:01.810Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:01.810Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:01.813Z] >>> [apiv2][query] GET https://firebasehosting.googleapis.com/v1beta1/projects/nyanco-bot/sites 
[debug] [2025-05-19T14:15:01.818Z] defaultcredentials: writing to file /Users/kozzy/.config/firebase/k_yamaoka0919_gmail.com_application_default_credentials.json
[debug] [2025-05-19T14:15:01.821Z] Setting GAC to /Users/kozzy/.config/firebase/k_yamaoka0919_gmail.com_application_default_credentials.json {"metadata":{"emulator":{"name":"functions"},"message":"Setting GAC to /Users/kozzy/.config/firebase/k_yamaoka0919_gmail.com_application_default_credentials.json"}}
[debug] [2025-05-19T14:15:01.823Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:01.823Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:01.823Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/nyanco-bot/adminSdkConfig [none]
[debug] [2025-05-19T14:15:02.221Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/nyanco-bot/adminSdkConfig 200
[debug] [2025-05-19T14:15:02.222Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/nyanco-bot/adminSdkConfig {"projectId":"nyanco-bot","storageBucket":"nyanco-bot.firebasestorage.app"}
[debug] [2025-05-19T14:15:02.600Z] <<< [apiv2][status] GET https://firebasehosting.googleapis.com/v1beta1/projects/nyanco-bot/sites 200
[debug] [2025-05-19T14:15:02.600Z] <<< [apiv2][body] GET https://firebasehosting.googleapis.com/v1beta1/projects/nyanco-bot/sites {"sites":[{"name":"projects/nyanco-bot/sites/nyanco-bot","defaultUrl":"https://nyanco-bot.web.app","appId":"1:242432500390:web:73cbabfb788522326e0a67","type":"DEFAULT_SITE"}]}
[debug] [2025-05-19T14:15:02.601Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:02.601Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:02.602Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/nyanco-bot/webApps/1:242432500390:web:73cbabfb788522326e0a67/config [none]
[debug] [2025-05-19T14:15:03.244Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/nyanco-bot/webApps/1:242432500390:web:73cbabfb788522326e0a67/config 200
[debug] [2025-05-19T14:15:03.244Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/nyanco-bot/webApps/1:242432500390:web:73cbabfb788522326e0a67/config {"projectId":"nyanco-bot","appId":"1:242432500390:web:73cbabfb788522326e0a67","storageBucket":"nyanco-bot.firebasestorage.app","apiKey":"AIzaSyD_fqZanQMmtDbzIkQNEhInPoycMbYzizo","authDomain":"nyanco-bot.firebaseapp.com","messagingSenderId":"242432500390","measurementId":"G-VR49RLP5NX"}
[debug] [2025-05-19T14:15:03.256Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:03.256Z] Checked if tokens are valid: true, expires at: 1747667150794
[debug] [2025-05-19T14:15:03.257Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/nyanco-bot [none]
[debug] [2025-05-19T14:15:03.556Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/nyanco-bot 200
[debug] [2025-05-19T14:15:03.556Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/nyanco-bot {"projectId":"nyanco-bot","projectNumber":"242432500390","displayName":"nyanco-bot","name":"projects/nyanco-bot","resources":{"hostingSite":"nyanco-bot"},"state":"ACTIVE","etag":"1_c0b179d6-d260-45b4-b4ec-9b84346ac258"}
[info] i  functions: Watching "/Users/kozzy/src/commupro-guild/functions" for Cloud Functions... {"metadata":{"emulator":{"name":"functions"},"message":"Watching \"/Users/kozzy/src/commupro-guild/functions\" for Cloud Functions..."}}
[info] i  hosting[nyanco-bot]: Serving hosting files from: public {"metadata":{"emulator":{"name":"hosting"},"message":"Serving hosting files from: \u001b[1mpublic\u001b[22m"}}
[info] ✔  hosting[nyanco-bot]: Local server: http://localhost:5002 {"metadata":{"emulator":{"name":"hosting"},"message":"Local server: \u001b[4m\u001b[1mhttp://localhost:5002\u001b[22m\u001b[24m"}}
[debug] [2025-05-19T14:15:03.629Z] Validating nodejs source
[debug] [2025-05-19T14:15:04.200Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "build": "tsc",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "discord.js": "^14.14.1",
    "firebase-admin": "^12.0.0",
    "firebase-functions": "^4.7.0"
  },
  "devDependencies": {
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-05-19T14:15:04.200Z] Building nodejs source
[debug] [2025-05-19T14:15:04.201Z] Failed to find version of module node: reached end of search path /Users/kozzy/src/commupro-guild/functions/node_modules
[warn] ⚠  functions: Your requested "node" version "18" doesn't match your global version "23". Using node@23 from host. 
[debug] [2025-05-19T14:15:04.202Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-19T14:15:04.207Z] Found firebase-functions binary at '/Users/kozzy/src/commupro-guild/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8814

[error] TypeError: functions.firestore.document is not a function
    at Object.<anonymous> (/Users/kozzy/src/commupro-guild/functions/lib/index.js:46:6)
    at Module._compile (node:internal/modules/cjs/loader:1734:14)
    at Object..js (node:internal/modules/cjs/loader:1899:10)
    at Module.load (node:internal/modules/cjs/loader:1469:32)
    at Function._load (node:internal/modules/cjs/loader:1286:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Module.require (node:internal/modules/cjs/loader:1491:12)
    at require (node:internal/modules/helpers:135:16)
    at loadModule (/Users/kozzy/src/commupro-guild/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)

[debug] [2025-05-19T14:15:04.710Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.firestore.document is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
